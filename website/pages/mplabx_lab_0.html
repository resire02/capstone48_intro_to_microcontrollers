<!DOCTYPE html>
<html lang="en">

<head>
    <title>MPLABX: UART and Timer</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Manuals about the basics of microcontrollers"/>
    <link rel="stylesheet" href="../globals.css">
</head>

<body>
    <header class="page-header">
            <div class="page-title">
                <img src="../images/128px-Microchip_Technology_logo.svg" />
                <a href="index.html" style="text-decoration: none;color:black;">
                    <h1>Introduction to Microcontrollers</h1>
                </a>
            </div>
            <div class="page-subheader">
                <ul>
                    <li>
                        <strong>Arduino</strong>
                    </li>
                    <li>
                        <a href="../pages/arduino_lab_0.html">Lab 0</a>
                    </li>
                    <li>
                        <a href="../pages/arduino_lab_1.html">Lab 1</a>
                    </li>
                    <li>
                        <a href="../pages/arduino_lab_2.html">Lab 2</a>
                    </li>
                    <li>
                        <a href="../pages/arduino_lab_3.html">Lab 3</a>
                    </li>
                    <li>
                        <a href="../pages/arduino_lab_4_project_requirements.html">Lab 4</a>
                    </li>
                    <li>
                        <a href="../pages/arduino_lab_4_project_solution.html">Lab 4 Solution</a>
                    </li>
                    <li>
                        <strong>MPLAB X IDE</strong>
                    </li>
                    <li>
                        <a href="../pages/mplabx_lab_0.html">Lab 0</a>
                    </li>
                    <li>
                        <a href="../pages/mplabx_lab_1.html">Lab 1</a>
                    </li>
                    <li>
                        <a href="../pages/mplabx_lab_2.html">Lab 2</a>
                    </li>
                    <li>
                        <a href="../pages/mplabx_lab_3.html">Lab 3</a>
                    </li>
                    <li>
                        <a href="../pages/mplabx_lab_4.html">Lab 4</a>
                    </li>
                    <li>
                        <a href="../pages/mplabx_lab_5.html">Lab 5</a>
                    </li>
                    <li>
                        <a href="../pages/mplabx_lab_6.html">Lab 6</a>
                    </li>
                </ul>
            </div>
        </header>
    <main>
        <h1 class="lab-header">Getting Started</h1>
        <section>
            <h2 class="section-header-title">Required Materials</h2>
            <p>
                This lab requires the following materials:
            <ul class="bullet-list">
                <li>Computer capable of running MP LAB X (Windows, Linux, MacOS), further system requirements found at
                    https://www.microchip.com/en-us/tools-resources/develop/mplab-x-ide</li>
                <li>Curiosity Nano AVR64DD32 board</li>
                <li>Micro USB to connect computer to board</li>
            </ul>
            </p>
        </section>
        <section>
            <h2 class="section-header-title">Learning Objective</h2>
            <p>
            <ul class="bullet-list">
                <li>How to install MP LAB X and it‚Äôs compiler</li>
                <li>How to connect MP LAB X to the board and install necessary libraries</li>
                <li>How to create a project and run code</li>
            </ul>
            </p>
        </section>
        <section>
            <h2 class="section-header-title">What is MPLAB X IDE?</h2>
            <p>
                In this section of the course, we will be learning how to use another embedded programming program,
                MPLAB X IDE. MPLAB X IDE is a proprietary integrated development environment designed to work with
                Microchip‚Äôs line of microcontrollers. It is most commonly used in professional or settings due to its
                encompassing set of developer features.
            </p>
        </section>
        <section>
            <h2 class="section-header-title">Why use MPLAB X IDE over Arduino IDE?</h2>
            <p>
                Leading up to this lab, you have been developing relatively simple programs using Arduino IDE. So why
                switch over to MPLAB X IDE? The reason ultimately comes down to differences in features:

            <ul>
                <li>MPLAB X IDE‚Äôs debugger offers deeper control of the chip‚Äôs embedded system with features such as
                    register bit manipulation, breakpoints, call stack, memory monitoring, application profiling, and
                    pin manager</li>
                <li>MPLAB X IDE‚Äôs project based development makes it easier to build out multi file programs than
                    Arduino IDE‚Äôs sketch based development.</li>
                <li>MPLAB X IDE‚Äôs Microchip Code Configurator simplifies adding peripherals to the project instead of
                    relying on third party libraries to configure peripherals</li>
            </ul>

            Ultimately, MPLAB X presents a more well rounded developer experience with professional features for greater
            control over the microcontroller.
            </p>
        </section>
        <section>
            <h2 class="section-header-title">Installation Walkthrough (MPLAB X IDE)</h2>
            <p>
            <ol class="bullet-list">
                <li>Go to the MPLAB X download page on microchips website at
                    https://www.microchip.com/en-us/tools-resources/develop/mplab-x-ide</li>
                <li>Download the MPLAB X IDE installer (Windows)</li>
                <li>Open the installer once it has finished downloading and select next, read license agreements before
                    proceeding. Leave the Use System Proxy settings and continue to the next screen.
                    <img src="../images/mplabx_lab0/install_step_1.png">
                </li>
                <br>
                <li>Select the MPLAB X IDE and the 32-bit MCU package, select next and begin the installation
                    <img src="../images/mplabx_lab0/install_step_2.png">
                </li>
                <br>
                <li>Next, select the 32-bit device compiler to install next
                    <img src="../images/mplabx_lab0/install_step_3.png">
                </li>
            </ol>
            </p>
        </section>
        <section>
            <h2 class="section-header-title">Installation Walkthrough (MPLAB XC32 Compiler) </h2>
            <p>
            <ol class="bullet-list">
                <li>The compiler install wizard should open after finishing the IDE installation process. If not, it can
                    be found at https://www.microchip.com/en-us/tools-resources/develop/mplab-xc-compilers/xc32
                    <img src="../images/mplabx_lab0/install_compiler_step_1.png">
                </li>
                <br>
                <li>At the licensing page, select the free license, select next, and begin the installation.
                    <img src="../images/mplabx_lab0/install_compiler_step_2.png">
                </li>
                <br>
                <li>After installation has completed, select next. And with that, MP LAB X should be successfully
                    installed for development with the Curiosity Nano.
                    <img src="../images/mplabx_lab0/install_compiler_step_3.png">
                </li>
            </ol>
            </p>
        </section>
        <section>
            <h2 class="section-header-title">Discover Portal</h2>
            <p>
                In this section, we will open MPLAB Discover. It is a searchable catalog for exploring project examples,
                documentation, tutorials, videos, source code and other resources for microcontroller devices.
            <ol class="bullet-list">
                <li>Locate the MPLAB Discover icon in the toolbar menu.
                    <img src="../images/mplabx_lab0/d.png">
                </li>
                <br>
                <li>This will open the Discover Portal. In the search bar, type ‚ÄòAVR64DD32‚Äô to find resources related to
                    the microcontroller.
                    <img src="../images/mplabx_lab0/d_2.png">
                </li>
            </ol>
            </p>
        </section>
        <section>
            <h2 class="section-header-title">Configuration</h2>
            <p>
                This section covers a few important configurations for using MPLAB X. Some of these configurations are
                recommendations and do not need to be changed.
            <h3>Setting the Color Theme and Font</h3>
            <p>
                The default theme for MPLAB X is very bright and can be hard on the eyes, so many users prefer to change
                it. To adjust the theme:
            <ol>
                <li>Navigate to Tools ‚Üí Options ‚Üí Fonts & Colors.</li>
                <li>Under Profile, select the theme you prefer. The recommended theme is Norway Today.</li>
                <li>To change the font, locate the Font section and click on the three dots.</li>
                <li>Select your desired font and size. The recommended font is Cascadia Code, as it matches the one used
                    in Visual Studio Code.</li>
            </ol>
            <h3>Managing Embedded Toolchains</h3>
            <p>
                The necessary toolchains should be added automatically when MPLAB X is installed. However, you can
                manage them manually if needed:
            <ol>
                <li>Go to Tools ‚Üí Options ‚Üí Embedded.</li>
                <li>Within the Embedded options, select Building Tools.</li>
                <li>You should see the XC8 compiler listed, which is the compiler we will use.</li>
            </ol>
            </p>
            </p>
        </section>
        <section>
            <h2 class="section-header-title">Content Manager</h2>
            <p>
                In this section, we will open the MCC Content Manager to update all libraries, drivers, and peripheral
                code related to the AVR64DD32. You need to have internet access to perform the updates.
            <ol class="bullet-list">
                <li>Locate the CM icon in the toolbar menu. Alternatively, access it by navigating to Tools -> MCC
                    Content Manager
                    <img src="../images/mplabx_lab0/cm.png">
                    <img src="../images/mplabx_lab0/cm_2.png">
                </li>
                <br>
                <li>In the search filters, open the Select Device pull down menu under Device, then type AVR64DD32 to
                    find the microcontroller. Click on it to select.
                    <img src="../images/mplabx_lab0/cm_3.png">
                </li>
                <br>
                <li>Click the Select Latest Version(s) button at the top center to choose the most recent versions of
                    the libraries.
                    <img src="../images/mplabx_lab0/cm_4.png">
                </li>
                <br>
                <li>After performing this selection, click on Apply.
                    <img src="../images/mplabx_lab0/cm_5.png">
                </li>
                <br>
                <li>Allow a few seconds for the libraries and drivers to download and install. Plug in your board, and
                    you should see the Curiosity Nano appear in your IDE!
                    <img src="../images/mplabx_lab0/cm_6.png"
                        style="max-height: 400px; margin: 10px">
                </li>
            </ol>
            </p>
        </section>
        <section>
            <h2 class="section-header-title">Create a New Bare Metal Project in MPLAB X</h2>
            <p>
            <ol class="bullet-list">
                <li><b>Start a New Project</b>
                    <ul>
                        <li>Go to File ‚áæ New Project</li>
                        <li>Select <b>Application Project(s)</b></li>
                    </ul>
                    <img src="../images/mplabx_lab0/p_1.png">
                </li>
                <br>
                <li><b>Select Device & Compiler</b>
                    <ul>
                        <li>Under <b>Select Device</b>, choose the appropriate one.</li>
                        <li>Set the compiler to <b>XC8.</b></li>
                    </ul>
                    <img src="../images/mplabx_lab0/p_2.png">
                </li>
                <br>
                <li><b>Set Project Name & Folder</b>
                    <ul>
                        <li>Enter <b>mplabx_lab0</b> as the project name.</li>
                        <li>Choose the default path in <b>Project Location</b> for your project.</li>
                        <li>Keep all other settings as defaults and click <b>Finish.</b></li>
                    </ul>
                </li>
                <br>
                <li><b>Understanding the Project Structure</b>
                    <ul>
                        <li>The newly created project is currently empty, with no files.</li>
                        <li>The <b>Projects tab</b> lists project resources and assets.</li>
                        <li>The <b>Files tab</b> displays the folder structure.</li>
                        <li>The <b>Dashboard</b> provides an overview, including the build environment, compiler
                            settings, and available software packs.</li>
                    </ul>
                </li>
                <br>
                <li><b>Adding main.c to the Project</b>
                    <ul>
                        <li>In the <b>Projects tab</b>, right-click <b>Source Files ‚Üí New ‚Üí main.c.</b></li>
                        <li>Name the file <b>main.</b></li>
                        <li>‚ö†Ô∏è Do not add it via the Files tab, as it won‚Äôt be registered in the build system.</li>
                    </ul>
                </li>
                <br>
                <li><b>Essential Headers in main.c</b>
                    <ul>
                        <li>In main.c, you will find the directive #include &lt;xc.h&gt;. This header provides
                            definitions
                            required by the compiler. To explore the definitions it provides, left click on the
                            directive and use <b>Navigate ‚Üí Go to Declaration / Definition.</b> In xc.h, you will find
                            the
                            following definitions:

                            <ul>
                                <li>avr/io.h ‚áæ Deprecated; no need to worry about it.</li>
                                <li>avr/builtins.h ‚áæ Contains built-in compiler functions; also not a concern.</li>
                                <li>NOP ‚áæ No Operation (used for timing or debugging).</li>
                                <li>ei ‚áæ Enables global interrupts.</li>
                                <li>di ‚áæ Disables global interrupts.</li>
                            </ul>

                        </li>

                    </ul>
                    <img src="../images/mplabx_lab0/p_3.png">
                </li>
                <br>
            </ol>
            </p>
        </section>
        <section>
            <h2 class="section-header-title">MPLAB Code Configurator</h2>
            <p>
                The MPLAB Code Configurator (MCC) provides a visual interface to add and configure peripherals within
                our projects. The MCC interface mainly consists of three views: the Resource Management Area, the
                Composer, and the Application Builder. The MCC view can be opened by clicking on the MCC icon on the
                main toolbar. <b>Keep in mind that in order to open MPLAB Code Configurator, there needs to be an active
                    project.</b>
                <img src="../images/mplabx_lab0/mcc_1.png"
                    style="max-height: 400px; margin: 10px">
            <ul>
                <li><b>Resource Management Area</b> (Top Left Panel) ‚Äì An interface to view available and currently used
                    resources in the project
                    <ul>
                        <li>
                            <b>Project Resources</b> ‚Äì Used to configure interrupts, pins, and system functions
                            including clock
                            and configuration bits. The ‚ÄúGenerate‚Äù button is used to create project code from the
                            configuration.
                        </li>
                        <li>
                            <b>Device Resources</b> ‚Äì Displays all hardware peripherals and system modules compatible
                            with the
                            target device (AVR64DD32 in our instance). Clicking on the plus icon next to the resource
                            adds the selected resource to both the Project Resources and Application Builder.
                        </li>
                    </ul>
                </li>
                <br>
                <li><b>Application Builder</b> (Top Middle Panel) ‚Äì A high level view of the application where
                    dependencies from Project Resources are visualized as a tree structure. The ‚ÄúAdd Component‚Äù button
                    is a windowed view to add and manage resources, similar to the Resource Management Area.
                    <ul>
                        <li>
                            <b>Application</b> ‚Äì represents user-created project resources, most prominently main.c
                        </li>
                        <li>
                            <b>System Drivers</b> ‚Äì represents system functionality such as clock, interrupt, and pins
                        </li>
                        <li>
                            <b>Device</b> ‚Äì lists the available hardware peripherals on the target device (AVR64DD32).
                            The
                            number represents the number of instances available to the project.
                        </li>
                    </ul>
                </li>
                <br>
                <li><b>Composer</b> (Right Panel) ‚Äì A hidden panel that can be accessed by clicking on the gear icon
                    next to resources on the Application Builder or by clicking on resources within Project Resources.
                    Displays configuration options for the selected resource.
                </li>
                <br>
                <li><b>Pin Package View</b> (Bottom Left Panel) ‚Äì A hardware level view of available and allocated pins
                    on the
                    (AVR64DD32) microcontroller. Clicking on a pin displays available functions to that pin.
                    <ul>
                        <li>
                            Grey pins ‚Äì the pin is not available.
                        </li>
                        <li>
                            Blue pins ‚Äì the pin is available.
                        </li>
                        <li>
                            Light green pins ‚Äì the pin is currently in use in the project.
                        </li>
                    </ul>
                </li>
                <br>
                <li><b>Pin Grid View</b> (Bottom Center Panel) ‚Äì Visualizes the available pins organized by GPIO port on
                    the
                    (AVR64DD32) microcontroller. Similar to how we used pinMode() in Arduino, we can configure a pin as
                    input or output by clicking in the grid.
                </li>
            </ul>
            </p>
        </section>
        <section>
            <h2 class="section-header-title">Understanding the Code: Blinking an LED on PORTF Pin 5</h2>
            <p>
                This program configures pin 5 on PORTF as an output and toggles an LED in a loop with delays. Below is a
                step-by-step breakdown of the key parts.
                <br><br>
                üìå <b>You can find this C file under IntroductionToMPLABX/Code/GettingStarted/mplabxlab0.c</b>
            <ol>
                <li><u>Define the LED Pin.</u>
                    <pre><code class="'language-c">
#define USR_LED 5
                                        </code></pre>
                    <ul>
                        <li>
                            <b>USR_LED</b> represents pin 5 on PORTF.
                        </li>
                    </ul>
                </li>
                <br>
                <li><u>Configure GPIO Pin 5 as an Output.</u>
                    <pre><code class="'language-c">
PORTF.DIRSET = (1 &lt;&lt; USR_LED);
                                        </code></pre>
                    <ul>
                        <li>
                            This sets bit 5 in the PORTF.DIR register to 1, configuring pin 5 as an output. The same
                            result can be achieved by using a <b>read-modify-write</b> operation like PORTF.DIR |= (1
                            &lt;&lt;
                            USR_LED). However DIRSET is faster and it also only modifies the specified bit without
                            affecting others. </li>
                        <li>
                            To apply this change manually, navigate to <b>Debugging ‚Üí IO View</b> and enable <b>bit
                                5.</b>
                        </li>
                    </ul>
                </li>
                <br>
                <li><u>Turn Off the LED (Active-Low Configuration)</u>
                    <pre><code class="'language-c">
PORTF_OUTSET = (1 &lt;&lt; USR_LED);
                                        </code></pre>
                    <ul>
                        <li>
                            We just made pin 5 into an output. However, since the board is active-low, the LED is
                            currently on because the <b>output register</b> is low (0). Now we set the output register
                            <b>high (1)</b>
                            to turn <b>off</b> the LED.
                        </li>
                    </ul>
                </li>
                <br>
                <li><u>Main Loop: Blinking an LED</u>
                    <ul>
                        <li>
                            Now we will blink an LED. First, let‚Äôs enter an infinite loop and clear bit 5 to set the
                            output low, turning the LED on.
                        </li>
                        <pre><code class="'language-c">
while (1) {
    PORTF.OUTCLR = (1 &lt;&lt; USR_LED);
}
                        </code></pre>
                        <li>
                            We will now introduce a delay. But first, we need to define timing parameters. When the chip
                            wakes up at reset, the hidden boot code in the part sets the oscillator to run at 4 MHz.
                            This must be configured in our program by defining the system clock frequency. Add this line
                            to the <b>top</b> of the program:
                        </li>
                        <pre><code class="'language-c">
#define F_CPU 4000000UL
                        </code></pre>
                        <li>
                            This definition is used by functions like <b>_delay_ms()</b> to calculate accurate time
                            delays. If
                            the value is incorrect, delays will be inaccurate. We also need to include the necessary
                            header file that provides <b>_delay_ms()</b>. Add this at the top of main.c.
                        </li>
                        <pre><code class="'language-c">
#include &lt;xc.h&gt;
#include &lt;util/delay.h&gt;
                        </code></pre>
                        <li>
                            Now we have access to the thread-blocking delay function _delay_ms(). In our loop, let‚Äôs
                            introduce a blocking delay of 100 milliseconds.
                        </li>
                        <pre><code class="'language-c">
while (1) {
    PORTF.OUTCLR = (1 &lt;&lt; USR_LED);
    _delay_ms(100);
}
                        </code></pre>
                        <li>
                            Now we can turn the LED off by setting bit 5 of the output register to high.
                        </li>
                        <pre><code class="'language-c">
while (1) {
    PORTF.OUTCLR = (1 &lt;&lt; USR_LED);
    _delay_ms(100);
    PORTF.OUTSET = (1 &lt;&lt; USR_LED);
}
                        </code></pre>
                        <li>
                            Finally, let‚Äôs introduce another blocking delay, keeping the LED off for 900 ms before
                            repeating the cycle.
                        </li>
                        <pre><code class="'language-c">
                            while (1) {
                                PORTF.OUTCLR = (1 &lt;&lt; USR_LED);
                                _delay_ms(100);
                                PORTF.OUTSET = (1 &lt;&lt; USR_LED);
                                _delay_ms(900);
                            }
                        </code></pre>
                    </ul>
                </li>
                <br>
                <li><u>Build the Program</u>
                    <ul>
                        <li>
                            Save the program and build it by clicking on the hammer icon <img
                                src="../images/mplabx_lab0/p_5.png"> in the toolbar.
                        </li>
                        <li>
                            In the project dashboard, you'll notice that the project is configured for the
                            <b>AVR64DD32</b>.
                            Right-click on <b>PORTF ‚Üí Definitions</b> to open the <b>ioavr64dd32.h</b> file. Each
                            microcontroller has
                            a dedicated header file like this, containing <b>#define</b> directives, symbolic names, and
                            specific pointer definitions, as all peripherals in this microcontroller are memory-mapped.
                            <b>PORTF</b> is actually a dereferenced pointer, and its memory location (in RAM) is
                            <b>0x04A0</b>
                        </li>
                        <li>
                            Scroll down to find the complete list of port structure definitions.
                        </li>
                        <li>
                            Once you're done, click on <b>Make and Program Device Main Project</b> <img
                                src="../images/mplabx_lab0/p_6.png">
                        </li>
                        <li>
                            If prompted, select the AVR64DD32 as your target tool.
                        </li>
                        <li>
                            See the blinking LED in action!
                        </li>
                    </ul>
                </li>
            </ol>
            </p>
        </section>
        <section>
            <h2 class="section-header-title">Debugging With MPLAB X</h2>
            <p>
                The MPLAB X IDE brings debugging to the table, which is both fun and useful.
            <ul class="bullet-list">
                <li>
                    Go to <b>Tools ‚Üí Options ‚Üí Embedded ‚Üí Generic Settings ‚Üí Debug Startup</b> and select <b>Halt at
                        Main</b>.
                </li>
                <li>
                    Now, run the program by clicking Debug Main Project. <img
                        src="../images/mplabx_lab0/p_7.png">
                </li>
                <li>
                    Go to <b>Window ‚Üí Debugging ‚Üí IO View</b> and scroll down to <b>PORTF</b> to inspect the state of
                    the ports during debugging.
                </li>
                <li>
                    Click <b>Step Over</b> <img src="../images/mplabx_lab0/p_8.png"> or
                    press <b>F8</b> to see the effect of the statement <b>PORTF.DIRSET</b>.
                </li>
                <li>
                    Step through the program until <b>PORTF.OUT</b> is set to high.
                </li>
                <img src="../images/mplabx_lab0/p_4.png">
                <p>
                    In this part of the debug process, we‚Äôre stepping through the program to observe the changes in
                    <b>PORTF</b>. When we step into the statement where <b>PORTF.DIRSET</b> is executed, you'll see that bit 5 of the
                    <b>PORTF</b> direction register is set, enabling the corresponding pin as an output. The amber LED is on
                    because the <b>PORTF.OUT</b> value is low (0), due to the active-low configuration of the LED. As we
                    continue stepping through, you'll notice that the <b>PORTF.OUT</b> value changes to high (1), turning the
                    LED off.
                    <br><br>
                    An important observation in modern microcontrollers like the AVR is that the <b>IN</b> pin will always
                    reflect the state of the <b>OUT</b> pin, due to an independent digital path. This means if there‚Äôs a
                    discrepancy between the <b>OUT</b> and <b>IN</b> states (e.g., <b>OUT</b> is high but <b>IN</b> is low), it indicates a problem,
                    such as a short circuit, which is useful for diagnostics.
                </p>
            </ul>
            </p>
        </section>
    </main>
    <footer class="footer">
        <a href="../index.html">
            Home
        </a>
        <a href="mplabx_lab_1.html">
            Next
        </a>
    </footer>
</body>

</html>